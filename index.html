<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶ì ‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂ ‡¶Æ‡ßá‡¶Æ‡ßã</title>
    <style>
        :root { --primary: #1a237e; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #eaeff2; margin: 0; padding: 10px; }

        .no-print { 
            max-width: 900px; margin: 0 auto 20px; background: #fff; padding: 15px; 
            border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-top: 5px solid var(--primary);
        }
        .controls { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px; }
        
        .btn { padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 13px; }
        .btn-blue { background: var(--primary); color: white; }
        .btn-purple { background: #673ab7; color: white; } /* ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° */
        .btn-orange { background: #ff9800; color: white; } /* ‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞ */
        .btn-red { background: #d32f2f; color: white; }
        .btn-green { background: #2e7d32; color: white; width: 100%; font-size: 18px; margin-top: 10px; }
        
        .memo-wrapper { display: flex; justify-content: center; padding-bottom: 50px; }
        .a5-container { 
            width: 148mm; min-height: 210mm; background: #fff; padding: 10mm; 
            border: 2px solid var(--primary); display: flex; flex-direction: column;
        }

        .header { display: flex; justify-content: space-between; border-bottom: 3px solid var(--primary); padding-bottom: 10px; margin-bottom: 15px; }
        .school-info { text-align: right; flex: 1; }
        .school-info h1 { margin: 0; font-size: 24px; color: var(--primary); font-weight: 800; }

        .memo-title { text-align: center; margin: 15px 0; }
        .memo-title span { background: var(--primary); color: white; padding: 5px 35px; border-radius: 50px; font-weight: bold; -webkit-print-color-adjust: exact; }

        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        table th, table td { border: 1px solid var(--primary); padding: 8px; text-align: center; font-size: 14px; }
        table th { background: var(--primary) !important; color: white !important; -webkit-print-color-adjust: exact; }
        
        .del-cell { color: red; cursor: pointer; font-weight: bold; }

        [contenteditable="true"] { outline: none; min-height: 20px; }
        [contenteditable="true"]:focus { background: #fffde7; }

        .footer-section { margin-top: auto; }
        .calc-area { display: flex; justify-content: space-between; align-items: flex-end; }
        .calc-box { width: 190px; border: 2px solid var(--primary); border-radius: 6px; overflow: hidden; }
        .calc-row { display: flex; justify-content: space-between; padding: 7px 10px; font-weight: bold; border-bottom: 1px solid #eee; }
        .grand-total { background: var(--primary); color: white; -webkit-print-color-adjust: exact; }

        .sign-area { display: flex; justify-content: space-between; margin-top: 50px; }
        .sign-box { border-top: 2px solid var(--primary); width: 130px; text-align: center; font-size: 13px; font-weight: bold; padding-top: 5px; color: var(--primary); }

        @media print {
            .no-print, .del-cell { display: none !important; }
            body { background: white; padding: 0; }
            .a5-container { border: 2px solid var(--primary) !important; width: 148mm; margin: 0 auto; }
            @page { size: A5; margin: 0; }
        }
    </style>
</head>
<body onload="autoLoad()">

<div class="no-print">
    <h3>‡¶ï‡ßç‡¶Ø‡¶æ‡¶∂‡¶Æ‡ßá‡¶Æ‡ßã ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h3>
    <div class="controls">
        <button class="btn btn-blue" onclick="addRow()">‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶∏‡¶æ‡¶∞‡¶ø</button>
        <button class="btn btn-purple" onclick="downloadJSON()">üì• ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ (JSON) ‡¶∏‡ßá‡¶≠</button>
        <button class="btn btn-orange" onclick="document.getElementById('importFile').click()">üì§ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞</button>
        <button class="btn btn-red" onclick="clearMemo()">üßπ ‡¶∏‡¶¨ ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
        <input type="file" id="importFile" style="display:none" accept=".json" onchange="importJSON(this)">
        <input type="file" accept="image/*" onchange="previewLogo(this)" style="font-size: 11px;">
    </div>
    <button class="btn btn-green" onclick="window.print()">üñ®Ô∏è ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>

<div class="memo-wrapper">
    <div class="a5-container">
        <div class="header">
            <div style="width: 60px;"><img id="dispLogo" src="https://via.placeholder.com/60?text=LOGO" style="max-width:100%;"></div>
            <div class="school-info">
                <h1 id="shopName" contenteditable="true">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</h1>
                <p id="shopAddr" contenteditable="true">‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ ‡¶ì ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</p>
            </div>
        </div>

        <div class="memo-title"><span>CASH MEMO</span></div>

        <div style="display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 14px;">
            <div style="flex:1">
                ‡¶®‡¶æ‡¶Æ: <span id="cName" contenteditable="true" style="border-bottom: 1px dotted #000; min-width: 180px; display: inline-block;"></span><br>
                ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ: <span id="cAddr" contenteditable="true" style="border-bottom: 1px dotted #000; min-width: 170px; display: inline-block;"></span>
            </div>
            <div style="text-align: right; font-weight: bold;">
                ‡¶≠‡¶æ‡¶â‡¶ö‡¶æ‡¶∞: <span id="vNo" contenteditable="true">#1001</span><br>
                ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: <span id="vDate" contenteditable="true"></span>
            </div>
        </div>

        <table id="mainTable">
            <thead>
                <tr>
                    <th width="8%">‡¶ï‡ßç‡¶∞‡¶É</th>
                    <th width="42%">‡¶¨‡¶ø‡¶¨‡¶∞‡¶£</th>
                    <th width="15%">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th>
                    <th width="15%">‡¶¶‡¶∞</th>
                    <th width="20%">‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ</th>
                    <th class="no-print" width="5%"></th>
                </tr>
            </thead>
            <tbody id="memoBody"></tbody>
            <tfoot>
                <tr style="background:#f0f2f5; font-weight:bold;">
                    <td colspan="4" style="text-align: right;">‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü:</td>
                    <td id="tableTotal"></td>
                    <td class="no-print"></td>
                </tr>
            </tfoot>
        </table>

        <div class="footer-section">
            <div class="calc-area">
                <div style="flex:1; font-size: 12px; font-weight:bold;">
                    ‡¶ï‡¶•‡¶æ‡ßü: <span id="words">................</span> ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞‡•§
                </div>
                <div class="calc-box">
                    <div class="calc-row"><span>‡¶Æ‡ßã‡¶ü:</span> <span id="subT">0.00</span></div>
                    <div class="calc-row" style="color:red;"><span>‡¶°‡¶ø‡¶∏‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü:</span> <span contenteditable="true" id="disc">0</span></div>
                    <div class="calc-row grand-total"><span>‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü:</span> <span id="grandT">0.00</span></div>
                </div>
            </div>
            <div class="sign-area">
                <div class="sign-box" contenteditable="true">‡¶ï‡ßç‡¶∞‡ßá‡¶§‡¶æ‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</div>
                <div class="sign-box" contenteditable="true">‡¶ï‡¶∞‡ßç‡¶§‡ßÉ‡¶™‡¶ï‡ßç‡¶∑‡ßá‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</div>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('vDate').innerText = new Date().toLocaleDateString('bn-BD');

    // ‡¶°‡¶æ‡¶ü‡¶æ ‡¶ï‡¶æ‡¶≤‡ßá‡¶ï‡¶∂‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function collectData() {
        const items = [];
        document.querySelectorAll('#memoBody tr').forEach(row => {
            items.push({
                desc: row.cells[1].innerText,
                qty: row.cells[2].innerText,
                price: row.cells[3].innerText
            });
        });
        return {
            shopName: document.getElementById('shopName').innerText,
            shopAddr: document.getElementById('shopAddr').innerText,
            cName: document.getElementById('cName').innerText,
            cAddr: document.getElementById('cAddr').innerText,
            vNo: document.getElementById('vNo').innerText,
            vDate: document.getElementById('vDate').innerText,
            disc: document.getElementById('disc').innerText,
            logo: document.getElementById('dispLogo').src,
            items: items
        };
    }

    // ‡ßß. ‡¶ú‡ßá‡¶∏‡¶® ‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° (JSON SAVE)
    function downloadJSON() {
        const dataStr = JSON.stringify(collectData(), null, 4);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        const exportFileDefaultName = 'memo_backup_' + new Date().getTime() + '.json';

        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
    }

    // ‡ß®. ‡¶ú‡ßá‡¶∏‡¶® ‡¶´‡¶æ‡¶á‡¶≤ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞ (JSON RESTORE)
    function importJSON(input) {
        const file = input.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                renderMemo(data);
                saveToLocal(); // ‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú‡ßá‡¶ì ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßá ‡¶®‡ßá‡¶¨‡ßá
                alert("‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶≤‡ßã‡¶° ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
            } catch (err) {
                alert("‡¶≠‡ßÅ‡¶≤ ‡¶´‡¶æ‡¶á‡¶≤! ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶†‡¶ø‡¶ï JSON ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
            }
        };
        reader.readAsText(file);
    }

    function renderMemo(data) {
        document.getElementById('shopName').innerText = data.shopName;
        document.getElementById('shopAddr').innerText = data.shopAddr;
        document.getElementById('cName').innerText = data.cName;
        document.getElementById('cAddr').innerText = data.cAddr;
        document.getElementById('vNo').innerText = data.vNo;
        document.getElementById('vDate').innerText = data.vDate;
        document.getElementById('disc').innerText = data.disc;
        document.getElementById('dispLogo').src = data.logo;

        const tbody = document.getElementById('memoBody');
        tbody.innerHTML = "";
        data.items.forEach(i => addRow(i.desc, i.qty, i.price));
        calculateAll();
    }

    // ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú ‡¶Ö‡¶ü‡ßã-‡¶∏‡ßá‡¶≠
    function saveToLocal() {
        localStorage.setItem('memo_auto_save', JSON.stringify(collectData()));
    }

    function addRow(desc="", qty="", price="") {
        const tbody = document.getElementById('memoBody');
        const nextNo = tbody.rows.length + 1;
        const row = document.createElement('tr');
        row.innerHTML = `
            <td contenteditable="true">${nextNo}</td>
            <td contenteditable="true" style="text-align: left;">${desc}</td>
            <td contenteditable="true" class="qty">${qty}</td>
            <td contenteditable="true" class="price">${price}</td>
            <td class="line-total"></td>
            <td class="del-cell no-print" onclick="this.parentElement.remove(); reNumber(); calculateAll(); saveToLocal();">‚úñ</td>
        `;
        tbody.appendChild(row);
        calculateAll();
    }

    function reNumber() {
        document.querySelectorAll('#memoBody tr').forEach((row, index) => {
            row.cells[0].innerText = index + 1;
        });
    }

    function calculateAll() {
        let subtotal = 0;
        document.querySelectorAll('#memoBody tr').forEach(row => {
            const qty = parseFloat(row.querySelector('.qty').innerText) || 0;
            const price = parseFloat(row.querySelector('.price').innerText) || 0;
            const total = qty * price;
            row.querySelector('.line-total').innerText = total > 0 ? total.toFixed(2) : "";
            if(total > 0) subtotal += total;
        });

        const disc = parseFloat(document.getElementById('disc').innerText) || 0;
        const final = subtotal - disc;
        document.getElementById('tableTotal').innerText = subtotal.toFixed(2);
        document.getElementById('subT').innerText = subtotal.toFixed(2);
        document.getElementById('grandT').innerText = final.toFixed(2);
        document.getElementById('words').innerText = final > 0 ? nToWords(final) : "................";
    }

    document.addEventListener('input', () => { calculateAll(); saveToLocal(); });

    function autoLoad() {
        const saved = localStorage.getItem('memo_auto_save');
        if(saved) renderMemo(JSON.parse(saved));
        else addRow();
    }

    function clearMemo() {
        if(confirm("‡¶∏‡¶¨ ‡¶Æ‡ßÅ‡¶õ‡¶¨‡ßá‡¶®?")) {
            localStorage.removeItem('memo_auto_save');
            location.reload();
        }
    }

    function previewLogo(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => { document.getElementById('dispLogo').src = e.target.result; saveToLocal(); };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function nToWords(n) {
        const units = ["", "‡¶è‡¶ï", "‡¶¶‡ßÅ‡¶á", "‡¶§‡¶ø‡¶®", "‡¶ö‡¶æ‡¶∞", "‡¶™‡¶æ‡¶Å‡¶ö", "‡¶õ‡¶Ø‡¶º", "‡¶∏‡¶æ‡¶§", "‡¶Ü‡¶ü", "‡¶®‡¶Ø‡¶º"];
        const teens = ["‡¶¶‡¶∂", "‡¶è‡¶ó‡¶æ‡¶∞‡ßã", "‡¶¨‡¶æ‡¶∞‡ßã", "‡¶§‡ßá‡¶∞‡ßã", "‡¶ö‡ßå‡¶¶‡ßç‡¶¶", "‡¶™‡¶®‡ßá‡¶∞‡ßã", "‡¶∑‡ßã‡¶≤‡ßã", "‡¶∏‡¶§‡ßá‡¶∞‡ßã", "‡¶Ü‡¶†‡¶æ‡¶∞‡ßã", "‡¶â‡¶®‡¶ø‡¶∂"];
        const tens = ["", "", "‡¶¨‡¶ø‡¶∂", "‡¶§‡ßç‡¶∞‡¶ø‡¶∂", "‡¶ö‡¶≤‡ßç‡¶≤‡¶ø‡¶∂", "‡¶™‡¶û‡ßç‡¶ö‡¶æ‡¶∂", "‡¶∑‡¶æ‡¶ü", "‡¶∏‡¶§‡ßç‡¶§‡¶∞", "‡¶Ü‡¶∂‡¶ø", "‡¶®‡¶¨‡ßç‡¶¨‡¶á"];
        function convert(num) {
            let res = "";
            if (num >= 10000000) { res += convert(Math.floor(num / 10000000)) + " ‡¶ï‡ßã‡¶ü‡¶ø "; num %= 10000000; }
            if (num >= 100000) { res += convert(Math.floor(num / 100000)) + " ‡¶≤‡¶ï‡ßç‡¶∑ "; num %= 100000; }
            if (num >= 1000) { res += convert(Math.floor(num / 1000)) + " ‡¶π‡¶æ‡¶ú‡¶æ‡¶∞ "; num %= 1000; }
            if (num >= 100) { res += units[Math.floor(num / 100)] + "‡¶∂‡¶§ "; num %= 100; }
            if (num >= 20) { res += tens[Math.floor(num / 10)] + " " + units[num % 10]; }
            else if (num >= 10) { res += teens[num - 10]; }
            else if (num > 0) { res += units[num]; }
            return res.trim();
        }
        return convert(Math.floor(n));
    }
</script>

</body>
</html>